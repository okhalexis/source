--// Loader WindUI (sempre latest)
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

--// Serviços
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

--// Variáveis Locais do Jogador
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

--// Ajustes básicos da Lib
WindUI:SetNotificationLower(true)
WindUI:SetFont("rbxassetid://0") 

--// Localization
WindUI:Localization({
    Enabled = true,
    Prefix = "loc:",
    DefaultLanguage = "en",
    Translations = {
        ["pt"] = {
            ["HUB_TITLE"]    = "Meu Super Hub",
            ["HUB_AUTHOR"]   = "by You",
            ["TAB_PLAYER"]   = "Player",
            ["TAB_FARM"]     = "Farm",
            ["TAB_SELLING"]  = "Selling",
            ["TAB_SETTINGS"] = "Configurações",
        },
        ["en"] = {
            ["HUB_TITLE"]    = "My Super Hub",
            ["HUB_AUTHOR"]   = "by You",
            ["TAB_PLAYER"]   = "Player",
            ["TAB_FARM"]     = "Farm",
            ["TAB_SELLING"]  = "Selling",
            ["TAB_SETTINGS"] = "Settings",
        },
    }
})

--// Tema base "Nebula"
WindUI:AddTheme({
    Name = "Nebula",
    Accent = Color3.fromHex("#18181b"),
    Background = Color3.fromHex("#050509"),
    BackgroundTransparency = 0,
    Outline = Color3.fromHex("#FFFFFF"),
    Text = Color3.fromHex("#FFFFFF"),
    Placeholder = Color3.fromHex("#7a7a7a"),
    Button = Color3.fromHex("#2b2b35"),
    Icon = Color3.fromHex("#a1a1aa"),
    Hover = Color3.fromHex("#FFFFFF"),
    WindowBackground = Color3.fromHex("#050509"),
    WindowShadow = Color3.fromHex("#000000"),
    DialogBackground = Color3.fromHex("#050509"),
    DialogBackgroundTransparency = 0,
    DialogTitle = Color3.fromHex("#FFFFFF"),
    DialogContent = Color3.fromHex("#FFFFFF"),
    DialogIcon = Color3.fromHex("#a1a1aa"),
    WindowTopbarButtonIcon = Color3.fromHex("a1a1aa"),
    WindowTopbarTitle = Color3.fromHex("FFFFFF"),
    WindowTopbarAuthor = Color3.fromHex("FFFFFF"),
    WindowTopbarIcon = Color3.fromHex("FFFFFF"),
    TabBackground = Color3.fromHex("#101019"),
    TabTitle = Color3.fromHex("#FFFFFF"),
    TabIcon = Color3.fromHex("a1a1aa"),
    ElementBackground = Color3.fromHex("#101019"),
    ElementTitle = Color3.fromHex("#FFFFFF"),
    ElementDesc = Color3.fromHex("#b0b0b0"),
    ElementIcon = Color3.fromHex("a1a1aa"),
    PopupBackground = Color3.fromHex("#050509"),
    PopupBackgroundTransparency = 0,
    PopupTitle = Color3.fromHex("#FFFFFF"),
    PopupContent = Color3.fromHex("#FFFFFF"),
    PopupIcon = Color3.fromHex("a1a1aa"),
    Toggle = Color3.fromHex("#52525b"),
    ToggleBar = Color3.fromHex("#FFFFFF"),
    Checkbox = Color3.fromHex("#52525b"),
    CheckboxIcon = Color3.fromHex("#FFFFFF"),
    Slider = Color3.fromHex("#52525b"),
    SliderThumb = Color3.fromHex("#FFFFFF"),
})

WindUI:Gradient({
    ["0"]   = { Color = Color3.fromHex("#0f172a"), Transparency = 0 },
    ["100"] = { Color = Color3.fromHex("#020617"), Transparency = 0 },
}, { Rotation = 45 })

WindUI:SetTheme("Nebula")

--// Window Principal
local Window = WindUI:CreateWindow({
    Title      = "loc:HUB_TITLE",
    Icon       = "door-open",
    Author     = "loc:HUB_AUTHOR",
    Folder     = "MySuperHub",
    Size       = UDim2.fromOffset(580, 460),
    Transparent= true,
    Theme      = "Nebula",
    Resizable  = true,
    SideBarWidth = 180,
})

Window:SetToggleKey(Enum.KeyCode.RightShift)

--// ==========================================
--// LÓGICA CORE (SPEED, JUMP, FLY, NOCLIP)
--// ==========================================

local Core = {
    Speed = { Enabled = false, Value = 16, Connection = nil },
    Jump = { Enabled = false, Value = 50, Connection = nil },
    Fly = { Enabled = false, Speed = 50, Connection = nil },
    NoClip = { Enabled = false, Connection = nil }
}

-- Funções Auxiliares
local function getChar() return LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait() end
local function getHum() return getChar():FindFirstChildOfClass("Humanoid") end
local function getRoot() return getChar():FindFirstChild("HumanoidRootPart") end

-- Sistema de Speed (Heartbeat Override)
local function UpdateSpeed()
    if Core.Speed.Connection then Core.Speed.Connection:Disconnect() end
    Core.Speed.Connection = RunService.Heartbeat:Connect(function()
        if Core.Speed.Enabled then
            local hum = getHum()
            if hum then
                hum.WalkSpeed = Core.Speed.Value
            end
        end
    end)
end

-- Sistema de Jump (Heartbeat Override)
local function UpdateJump()
    if Core.Jump.Connection then Core.Jump.Connection:Disconnect() end
    Core.Jump.Connection = RunService.Heartbeat:Connect(function()
        if Core.Jump.Enabled then
            local hum = getHum()
            if hum then
                hum.UseJumpPower = true 
                hum.JumpPower = Core.Jump.Value
            end
        end
    end)
end

-- Sistema de Fly (CFrame - Fluido)
local FlyKeys = {W=false, A=false, S=false, D=false, Space=false, Ctrl=false}

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.W then FlyKeys.W = true end
    if input.KeyCode == Enum.KeyCode.A then FlyKeys.A = true end
    if input.KeyCode == Enum.KeyCode.S then FlyKeys.S = true end
    if input.KeyCode == Enum.KeyCode.D then FlyKeys.D = true end
    if input.KeyCode == Enum.KeyCode.Space then FlyKeys.Space = true end
    if input.KeyCode == Enum.KeyCode.LeftControl then FlyKeys.Ctrl = true end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.W then FlyKeys.W = false end
    if input.KeyCode == Enum.KeyCode.A then FlyKeys.A = false end
    if input.KeyCode == Enum.KeyCode.S then FlyKeys.S = false end
    if input.KeyCode == Enum.KeyCode.D then FlyKeys.D = false end
    if input.KeyCode == Enum.KeyCode.Space then FlyKeys.Space = false end
    if input.KeyCode == Enum.KeyCode.LeftControl then FlyKeys.Ctrl = false end
end)

local function ToggleFly(state)
    Core.Fly.Enabled = state
    local root = getRoot()
    local hum = getHum()

    if state then
        if Core.Fly.Connection then Core.Fly.Connection:Disconnect() end
        if hum then hum.PlatformStand = true end -- Desativa física padrão
        
        Core.Fly.Connection = RunService.RenderStepped:Connect(function(dt)
            if not Core.Fly.Enabled or not root then return end
            
            local speed = Core.Fly.Speed
            local vel = Vector3.zero
            
            if FlyKeys.W then vel = vel + (Camera.CFrame.LookVector * speed) end
            if FlyKeys.S then vel = vel - (Camera.CFrame.LookVector * speed) end
            if FlyKeys.A then vel = vel - (Camera.CFrame.RightVector * speed) end
            if FlyKeys.D then vel = vel + (Camera.CFrame.RightVector * speed) end
            if FlyKeys.Space then vel = vel + (Vector3.new(0,1,0) * speed) end
            if FlyKeys.Ctrl then vel = vel - (Vector3.new(0,1,0) * speed) end
            
            root.Velocity = Vector3.zero 
            root.CFrame = root.CFrame + (vel * dt)
        end)
    else
        if Core.Fly.Connection then Core.Fly.Connection:Disconnect() end
        if hum then hum.PlatformStand = false end
        if root then root.Velocity = Vector3.zero end
    end
end

-- Sistema de NoClip (Stepped Override)
-- Tenta evitar cair do chão mantendo colisão se não estiver movendo ou se for chão
local function ToggleNoClip(state)
    Core.NoClip.Enabled = state
    if Core.NoClip.Connection then Core.NoClip.Connection:Disconnect() end

    if state then
        Core.NoClip.Connection = RunService.Stepped:Connect(function()
            if not Core.NoClip.Enabled then return end
            local char = getChar()
            if char then
                for _, part in pairs(char:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide then
                        -- Lógica simples: Se estiver voando, desativa tudo.
                        -- Se NÃO estiver voando, mantém colisão nas pernas para não cair?
                        -- Isso costuma ser bugado. A melhor abordagem para "Não cair do mapa"
                        -- é o usuário usar FLY junto, ou usarmos Raycast.
                        -- Para estabilidade, desativamos colisão, mas o usuário deve controlar.
                        part.CanCollide = false 
                    end
                end
            end
        end)
    end
end

--// ==========================================
--// INTERFACE GRÁFICA (TABS)
--// ==========================================

local Tabs = {
    Player   = Window:Tab({ Title = "loc:TAB_PLAYER",   Icon = "user" }),
    Farm     = Window:Tab({ Title = "loc:TAB_FARM",     Icon = "wheat" }), -- Aba Restaurada
    Selling  = Window:Tab({ Title = "loc:TAB_SELLING",  Icon = "shopping-bag" }), -- Aba Restaurada
    Settings = Window:Tab({ Title = "loc:TAB_SETTINGS", Icon = "settings" }),
}

Window:SelectTab(1)

----------------------------------------------------
-- TAB: PLAYER (Funcionalidades Principais)
----------------------------------------------------
local PlayerSection = Tabs.Player:Section({
    Title = "Player Attributes",
    Box = true,
    Opened = true,
})

-- SPEED
PlayerSection:Toggle({
    Title = "Speed",
    Desc  = "Define a velocidade (Sobrescreve sistema do jogo).",
    Icon  = "gauge",
    Value = false,
    Callback = function(state)
        Core.Speed.Enabled = state
        if not state then
            local hum = getHum()
            if hum then hum.WalkSpeed = 16 end
        end
        UpdateSpeed()
    end
})

PlayerSection:Slider({
    Title = "Custom Speed",
    Desc  = "Intervalo: 16 - 1000",
    Step  = 1,
    Value = { Min = 16, Max = 1000, Default = 16 },
    Callback = function(v)
        Core.Speed.Value = v
    end
})

-- JUMP
PlayerSection:Toggle({
    Title = "Jump Power",
    Desc  = "Define altura do pulo (Sobrescreve bloqueios).",
    Icon  = "arrow-up",
    Value = false,
    Callback = function(state)
        Core.Jump.Enabled = state
        if not state then
            local hum = getHum()
            if hum then hum.JumpPower = 50 end
        end
        UpdateJump()
    end
})

PlayerSection:Slider({
    Title = "Jump Height",
    Desc  = "Intervalo: 50 - 300",
    Step  = 1,
    Value = { Min = 50, Max = 300, Default = 50 },
    Callback = function(v)
        Core.Jump.Value = v
    end
})

-- ABILITIES SECTION
local AbilitiesSection = Tabs.Player:Section({
    Title = "Abilities",
    Box = true,
    Opened = true,
})

-- FLY
AbilitiesSection:Toggle({
    Title = "Fly",
    Desc  = "Voo livre (WASD + Space/Ctrl). Sem inércia.",
    Icon  = "plane",
    Value = false,
    Callback = function(state)
        ToggleFly(state)
    end
})

AbilitiesSection:Slider({
    Title = "Fly Speed",
    Desc  = "Velocidade do voo.",
    Step  = 1,
    Value = { Min = 10, Max = 500, Default = 50 },
    Callback = function(v)
        Core.Fly.Speed = v
    end
})

-- NOCLIP
AbilitiesSection:Toggle({
    Title = "NoClip",
    Desc  = "Atravessa paredes e objetos.",
    Icon  = "ghost",
    Value = false,
    Callback = function(state)
        ToggleNoClip(state)
        if state then
            WindUI:Notify({
                Title = "Aviso",
                Content = "NoClip ativo. Use com Fly para evitar cair do mapa.",
                Icon = "alert-triangle",
                Duration = 4
            })
        end
    end
})

----------------------------------------------------
-- TAB: FARM (Aba presente, conteúdo removido)
----------------------------------------------------
local FarmSection = Tabs.Farm:Section({
    Title = "Auto Farm",
    Box = true,
    Opened = true,
})

FarmSection:Paragraph({
    Title = "Manutenção",
    Content = "As funcionalidades de Farm foram removidas temporariamente para aprimoramento."
})

----------------------------------------------------
-- TAB: SELLING (Aba presente, conteúdo removido)
----------------------------------------------------
local SellingSection = Tabs.Selling:Section({
    Title = "Auto Sell",
    Box = true,
    Opened = true,
})

SellingSection:Paragraph({
    Title = "Manutenção",
    Content = "As funcionalidades de Selling foram removidas temporariamente para aprimoramento."
})

----------------------------------------------------
-- TAB: SETTINGS
----------------------------------------------------
local SettingsSection = Tabs.Settings:Section({
    Title = "Interface Config",
    Box = true,
    Opened = true,
})

SettingsSection:Keybind({
    Title = "Menu Key",
    Desc  = "Tecla para abrir/fechar o Hub.",
    Value = "RightShift",
    Callback = function(key)
        Window:SetToggleKey(Enum.KeyCode[key])
    end
})

local Themes = WindUI:GetThemes()
local ThemeList = {}
for name, _ in pairs(Themes) do table.insert(ThemeList, name) end

SettingsSection:Dropdown({
    Title = "Theme",
    Values = ThemeList,
    Value = "Nebula",
    Callback = function(t)
        WindUI:SetTheme(t)
    end
})

SettingsSection:Button({
    Title = "Descarregar Script",
    Color = Color3.fromRGB(200, 60, 60),
    Callback = function()
        -- Limpa loops
        if Core.Speed.Connection then Core.Speed.Connection:Disconnect() end
        if Core.Jump.Connection then Core.Jump.Connection:Disconnect() end
        if Core.Fly.Connection then Core.Fly.Connection:Disconnect() end
        if Core.NoClip.Connection then Core.NoClip.Connection:Disconnect() end
        
        -- Reseta status
        local hum = getHum()
        if hum then 
            hum.WalkSpeed = 16 
            hum.JumpPower = 50 
            hum.PlatformStand = false
        end
        
        Window:Close() -- Caso WindUI suporte
        WindUI:Notify({Title="Script", Content="Script finalizado.", Duration=2})
    end
})
