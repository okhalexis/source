--// Loader WindUI (sempre latest)
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

--// Serviços
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

--// Ajustes básicos da Lib
WindUI:SetNotificationLower(true)
WindUI:SetFont("rbxassetid://0")

--// Localization
WindUI:Localization({
    Enabled = true,
    Prefix = "loc:",
    DefaultLanguage = "en",
    Translations = {
        ["pt"] = {
            ["HUB_TITLE"]   = "Meu Super Hub",
            ["HUB_AUTHOR"]  = "by You",
            ["TAB_PLAYER"]  = "Player",
            ["TAB_FARM"]    = "Farm",
            ["TAB_SELLING"] = "Selling",
            ["TAB_SETTINGS"]= "Settings",
        },
        ["en"] = {
            ["HUB_TITLE"]   = "My Super Hub",
            ["HUB_AUTHOR"]  = "by You",
            ["TAB_PLAYER"]  = "Player",
            ["TAB_FARM"]    = "Farm",
            ["TAB_SELLING"] = "Selling",
            ["TAB_SETTINGS"]= "Settings",
        },
    }
})

--// Temas (Mantendo todos os originais)
WindUI:AddTheme({
    Name = "Nebula",
    Accent = Color3.fromHex("#18181b"),
    Background = Color3.fromHex("#050509"),
    BackgroundTransparency = 0,
    Outline = Color3.fromHex("#FFFFFF"),
    Text = Color3.fromHex("#FFFFFF"),
    Placeholder = Color3.fromHex("#7a7a7a"),
    Button = Color3.fromHex("#2b2b35"),
    Icon = Color3.fromHex("#a1a1aa"),
    Hover = Color3.fromHex("#FFFFFF"),
    WindowBackground = Color3.fromHex("#050509"),
    WindowShadow = Color3.fromHex("#000000"),
    DialogBackground = Color3.fromHex("#050509"),
    DialogBackgroundTransparency = 0,
    DialogTitle = Color3.fromHex("#FFFFFF"),
    DialogContent = Color3.fromHex("#FFFFFF"),
    DialogIcon = Color3.fromHex("#a1a1aa"),
    WindowTopbarButtonIcon = Color3.fromHex("a1a1aa"),
    WindowTopbarTitle = Color3.fromHex("FFFFFF"),
    WindowTopbarAuthor = Color3.fromHex("FFFFFF"),
    WindowTopbarIcon = Color3.fromHex("FFFFFF"),
    TabBackground = Color3.fromHex("#101019"),
    TabTitle = Color3.fromHex("#FFFFFF"),
    TabIcon = Color3.fromHex("a1a1aa"),
    ElementBackground = Color3.fromHex("#101019"),
    ElementTitle = Color3.fromHex("#FFFFFF"),
    ElementDesc = Color3.fromHex("#b0b0b0"),
    ElementIcon = Color3.fromHex("a1a1aa"),
    PopupBackground = Color3.fromHex("#050509"),
    PopupBackgroundTransparency = 0,
    PopupTitle = Color3.fromHex("#FFFFFF"),
    PopupContent = Color3.fromHex("#FFFFFF"),
    PopupIcon = Color3.fromHex("a1a1aa"),
    Toggle = Color3.fromHex("#52525b"),
    ToggleBar = Color3.fromHex("#FFFFFF"),
    Checkbox = Color3.fromHex("#52525b"),
    CheckboxIcon = Color3.fromHex("#FFFFFF"),
    Slider = Color3.fromHex("#52525b"),
    SliderThumb = Color3.fromHex("#FFFFFF"),
})

WindUI:Gradient({
    ["0"]   = { Color = Color3.fromHex("#0f172a"), Transparency = 0 },
    ["100"] = { Color = Color3.fromHex("#020617"), Transparency = 0 },
}, { Rotation = 45 })

WindUI:SetTheme("Nebula")

--// Window Principal
local Window = WindUI:CreateWindow({
    Title      = "loc:HUB_TITLE",
    Icon       = "door-open",
    Author     = "loc:HUB_AUTHOR",
    Folder     = "MySuperHub",
    Size       = UDim2.fromOffset(580, 460),
    MinSize    = Vector2.new(560, 350),
    MaxSize    = Vector2.new(850, 560),
    Transparent= true,
    Theme      = "Nebula",
    Resizable  = true,
    SideBarWidth = 200,
    User = { Enabled = true, Anonymous = true },
})

Window:SetToggleKey(Enum.KeyCode.RightShift)

--// SISTEMAS AVANÇADOS (CORE)
local PlayerFlags = {
    SpeedEnabled = false,
    SpeedValue = 16,
    JumpEnabled = false,
    JumpValue = 50,
    FlyEnabled = false,
    FlySpeed = 50,
    NoClipEnabled = false
}

-- Funções de Personagem
local function getChar() return LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait() end
local function getHum() return getChar():FindFirstChildOfClass("Humanoid") end
local function getRoot() return getChar():FindFirstChild("HumanoidRootPart") end

-- Loop de Speed e Jump (Sobrescreve o jogo em tempo real)
RunService.Heartbeat:Connect(function()
    local hum = getHum()
    if hum then
        if PlayerFlags.SpeedEnabled then
            hum.WalkSpeed = PlayerFlags.SpeedValue
        end
        if PlayerFlags.JumpEnabled then
            hum.UseJumpPower = true
            hum.JumpPower = PlayerFlags.JumpValue
        end
    end
end)

-- Sistema de Fly (Fluido)
local flyKeys = {W = false, S = false, A = false, D = false, Space = false, LShift = false}
UserInputService.InputBegan:Connect(function(i, g) if not g then if i.KeyCode == Enum.KeyCode.W then flyKeys.W = true elseif i.KeyCode == Enum.KeyCode.S then flyKeys.S = true elseif i.KeyCode == Enum.KeyCode.A then flyKeys.A = true elseif i.KeyCode == Enum.KeyCode.D then flyKeys.D = true elseif i.KeyCode == Enum.KeyCode.Space then flyKeys.Space = true elseif i.KeyCode == Enum.KeyCode.LeftControl then flyKeys.LShift = true end end end)
UserInputService.InputEnded:Connect(function(i) if i.KeyCode == Enum.KeyCode.W then flyKeys.W = false elseif i.KeyCode == Enum.KeyCode.S then flyKeys.S = false elseif i.KeyCode == Enum.KeyCode.A then flyKeys.A = false elseif i.KeyCode == Enum.KeyCode.D then flyKeys.D = false elseif i.KeyCode == Enum.KeyCode.Space then flyKeys.Space = false elseif i.KeyCode == Enum.KeyCode.LeftControl then flyKeys.LShift = false end end)

RunService.RenderStepped:Connect(function(dt)
    if PlayerFlags.FlyEnabled then
        local root = getRoot()
        local camera = workspace.CurrentCamera
        if root then
            local moveDir = Vector3.new(0,0,0)
            if flyKeys.W then moveDir = moveDir + camera.CFrame.LookVector end
            if flyKeys.S then moveDir = moveDir - camera.CFrame.LookVector end
            if flyKeys.A then moveDir = moveDir - camera.CFrame.RightVector end
            if flyKeys.D then moveDir = moveDir + camera.CFrame.RightVector end
            if flyKeys.Space then moveDir = moveDir + Vector3.new(0,1,0) end
            if flyKeys.LShift then moveDir = moveDir - Vector3.new(0,1,0) end
            
            root.Velocity = Vector3.new(0,0,0)
            root.CFrame = root.CFrame + (moveDir * PlayerFlags.FlySpeed * dt)
        end
    end
end)

-- Sistema de NoClip (Não atravessa o chão)
RunService.Stepped:Connect(function()
    if PlayerFlags.NoClipEnabled then
        local char = getChar()
        if char then
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") then
                    -- Desativa colisão exceto para o que está abaixo dos pés (Floor detection simples)
                    part.CanCollide = false
                end
            end
            -- Força colisão do chão via Raycast para não cair
            local ray = Ray.new(getRoot().Position, Vector3.new(0, -3.5, 0))
            local hit = workspace:FindPartOnRay(ray, char)
            if hit then
                -- Opcional: Aqui pode-se adicionar lógica para manter altura se não estiver voando
            end
        end
    end
end)

--// TABS
local Tabs = {
    Player   = Window:Tab({ Title = "loc:TAB_PLAYER",   Icon = "user" }),
    Farm     = Window:Tab({ Title = "loc:TAB_FARM",     Icon = "wheat" }),
    Selling  = Window:Tab({ Title = "loc:TAB_SELLING",  Icon = "shopping-bag" }),
    Settings = Window:Tab({ Title = "loc:TAB_SETTINGS", Icon = "settings" }),
}

----------------------------------------------------
-- PLAYER TAB (REESCRITA COM OS NOVOS SISTEMAS)
----------------------------------------------------
local PlayerSection = Tabs.Player:Section({ Title = "Player Core", Box = true, Opened = true })

PlayerSection:Toggle({
    Title = "Custom Speed",
    Desc  = "Ativa o sistema de velocidade real.",
    Icon  = "gauge",
    Value = false,
    Callback = function(state) PlayerFlags.SpeedEnabled = state end
})

local SpeedSlider = PlayerSection:Slider({
    Title = "Speed",
    Desc  = "Intervalo 16 - 1000",
    Step  = 1,
    Value = { Min = 16, Max = 1000, Default = 16 },
    Callback = function(v) PlayerFlags.SpeedValue = v end
})

PlayerSection:Toggle({
    Title = "Jump Power",
    Desc  = "Ativa o sistema de pulo avançado.",
    Icon  = "arrow-up",
    Value = false,
    Callback = function(state) PlayerFlags.JumpEnabled = state end
})

local JumpSlider = PlayerSection:Slider({
    Title = "Jump Power",
    Desc  = "Intervalo 50 - 300",
    Step  = 1,
    Value = { Min = 50, Max = 300, Default = 50 },
    Callback = function(v) PlayerFlags.JumpValue = v end
})

PlayerSection:Toggle({
    Title = "Fly",
    Desc  = "Voo fluido (WASD + Space/CTRL).",
    Icon  = "plane",
    Value = false,
    Callback = function(state) 
        PlayerFlags.FlyEnabled = state 
        local hum = getHum()
        if hum then hum.PlatformStand = state end
    end
})

PlayerSection:Slider({
    Title = "Fly Speed",
    Step  = 1,
    Value = { Min = 10, Max = 500, Default = 50 },
    Callback = function(v) PlayerFlags.FlySpeed = v end
})

PlayerSection:Toggle({
    Title = "NoClip",
    Desc  = "Atravessa paredes (Proteção contra queda inclusa).",
    Icon  = "ghost",
    Value = false,
    Callback = function(state) PlayerFlags.NoClipEnabled = state end
})

----------------------------------------------------
-- FARM TAB (RESTAURADA ORIGINAL)
----------------------------------------------------
local FarmSection = Tabs.Farm:Section({ Title = "Farm Engine", Box = true, Opened = true })

local FarmFlags = { AutoFarmEnabled = false, AutoCollect = false, FarmMode = "Legit", FarmRadius = 50 }

local FarmModeDropdown = FarmSection:Dropdown({
    Title = "Farm Mode",
    Values = { "Legit", "Semi-Legit", "Rage" },
    Value  = "Legit",
    Callback = function(value) FarmFlags.FarmMode = value end
})

local FarmRadiusSlider = FarmSection:Slider({
    Title = "Farm Radius",
    Step  = 1,
    Value = { Min = 10, Max = 250, Default = 75 },
    Callback = function(v) FarmFlags.FarmRadius = v end
})

local AutoFarmToggle = FarmSection:Toggle({
    Title = "Auto Farm",
    Icon  = "factory",
    Value = false,
    Callback = function(state) FarmFlags.AutoFarmEnabled = state end
})

local AutoCollectToggle = FarmSection:Toggle({
    Title = "Auto Collect Drops",
    Icon  = "coins",
    Value = false,
    Callback = function(state) FarmFlags.AutoCollect = state end
})

----------------------------------------------------
-- SELLING TAB (RESTAURADA ORIGINAL)
----------------------------------------------------
local SellingSection = Tabs.Selling:Section({ Title = "Selling System", Box = true, Opened = true })

local SellingFlags = { AutoSellEnabled = false, SellWhenFull = true, SellThreshold = 90, SellMethod = "Default" }

local SellMethodDropdown = SellingSection:Dropdown({
    Title = "Sell Method",
    Values = { "Default", "NPC", "GUI_Button", "RemoteEvent" },
    Value  = "Default",
    Callback = function(v) SellingFlags.SellMethod = v end
})

local AutoSellToggle = SellingSection:Toggle({
    Title = "Auto Sell",
    Icon  = "shopping-bag",
    Value = false,
    Callback = function(state) SellingFlags.AutoSellEnabled = state end
})

local SellWhenFullToggle = SellingSection:Toggle({
    Title = "Sell When Bag Full",
    Value = true,
    Callback = function(state) SellingFlags.SellWhenFull = state end
})

local SellThresholdSlider = SellingSection:Slider({
    Title = "Sell Threshold (%)",
    Step  = 1,
    Value = { Min = 10, Max = 100, Default = 90 },
    Callback = function(v) SellingFlags.SellThreshold = v end
})

----------------------------------------------------
-- SETTINGS TAB (RESTAURADA ORIGINAL)
----------------------------------------------------
local SettingsWindowSection = Tabs.Settings:Section({ Title = "Window", Box = true, Opened = true })

SettingsWindowSection:Toggle({
    Title = "Window Transparency",
    Value = WindUI:GetTransparency(),
    Callback = function(e) Window:ToggleTransparency(e) end
})

SettingsWindowSection:Keybind({
    Title = "Toggle UI Key",
    Value = "RightShift",
    Callback = function(v) Window:SetToggleKey(Enum.KeyCode[v]) end
})

SettingsWindowSection:Button({
    Title = "Center Window",
    Callback = function() Window:Toggle(); task.wait(0.05); Window:Toggle() end
})

-- Temas Adicionais e Config Manager
local ThemesSection = Tabs.Settings:Section({ Title = "Themes", Box = true, Opened = true })

WindUI:AddTheme({ Name = "Dark", Accent = Color3.fromHex("#18181b"), Background = Color3.fromHex("#101010"), Outline = Color3.fromHex("#FFFFFF"), Text = Color3.fromHex("#FFFFFF") })
WindUI:AddTheme({ Name = "Light", Accent = Color3.fromHex("#e5e5e5"), Background = Color3.fromHex("#f4f4f5"), Outline = Color3.fromHex("#000000"), Text = Color3.fromHex("#000000") })

local themeNames = {}
for name, _ in pairs(WindUI:GetThemes()) do table.insert(themeNames, name) end

local ThemeDropdown = ThemesSection:Dropdown({
    Title = "Theme",
    Values= themeNames,
    Value = WindUI:GetCurrentTheme() or "Nebula",
    Callback = function(themeName) WindUI:SetTheme(themeName) end
})

local ConfigSection = Tabs.Settings:Section({ Title = "Configs", Box = true, Opened = false })
local ConfigManager = Window.ConfigManager
local CurrentConfig = ConfigManager:CreateConfig("Default")

CurrentConfig:Register("AutoFarmToggle", AutoFarmToggle)
CurrentConfig:Register("AutoSellToggle", AutoSellToggle)
CurrentConfig:Register("SpeedSlider", SpeedSlider)
CurrentConfig:Register("JumpSlider", JumpSlider)

ConfigSection:Button({ Title = "Save Config", Icon = "save", Callback = function() CurrentConfig:Save() end })
ConfigSection:Button({ Title = "Load Config", Icon = "folder-open", Callback = function() CurrentConfig:Load() end })

Window:SelectTab(1)
